;/*FB_PKG_DELIM*/

__d("MaybeNativePromise",["Promise"],(function(t,n,r,o,a,i){"use strict";var e,l=t.Promise||e||(e=n("Promise"));(e||(e=n("Promise"))).resolve();var s=l;i.default=s}),66);
__d("VideoAkamaiRequestHelper",["URI"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return e.toLowerCase().indexOf("akamai")!==-1}function u(e){var t=e.endByte,n=e.startByte;if(n!=null&&!(n===0&&t==null)){var r="bytes="+n+"-"+(t==null?"":t);return{Range:r}}return null}function c(t){var n=new(e||(e=r("URI")))(t),o=n.getQueryData(),a=o.endByte,i=o.startByte;return u({baseUrl:t,startByte:i,endByte:a})}l.isAkamai=s,l.getRequestHeaders=u,l.getRequestHeadersFromUrl=c}),98);
__d("VideoDashPrefetchCacheUtils",["ConstUriUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=o("ConstUriUtils").getUri(e),n=t==null?void 0:t.getDomain();return n!=null&&n.endsWith("fbcdn.net")&&!n.startsWith("interncache")&&!n.endsWith("ak.fbcdn.net")}function s(e){var t=o("ConstUriUtils").getUri(e);if(t!=null&&t.getDomain()){var n,r,a=["oh","__gda__"],i=t==null?void 0:t.getQueryParams().keys();if(i!=null)for(var l of i)l.startsWith("_nc")&&a.push(l);return(n=t==null||(r=t.removeQueryParams(a))==null?void 0:r.toString())!=null?n:e}return e}l.isFBCDN=e,l.stripNonCachingParams=s}),98);
__d("parseHeaders",[],(function(t,n,r,o,a,i){var e=/\r?\n[\t]+/g,l=/\r?\n/;function s(t){var n=t.replace(e," "),r={};return n.split(l).forEach(function(e){var t=e.split(":"),n=t.shift().trim();if(n){var o=t.join(":").trim();r[n.toLowerCase()]=o}}),r}i.default=s}),66);
__d("VideoPlayerShakaError",["parseHeaders"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var o=e.errorRawTransportStatus,a=null;return e.errorRawResponseHeaders!=null&&(a=r("parseHeaders")(e.errorRawResponseHeaders)),{name:e.errorType,message:e.errorMsg,type:n,url:t,status:o,responseHeaders:a}}function s(e){return{name:"timeout",message:"timeout",type:"net",url:e,status:0,responseHeaders:null}}l.translateError=e,l.createTimeoutError=s}),98);
__d("VideoDashPrefetchCache",["ConstUriUtils","Deferred","FBLogger","MaybeNativePromise","ODS","Promise","VideoAkamaiRequestHelper","VideoDashPrefetchCacheUtils","VideoPlayerPrefetchExperiments","VideoPlayerShakaError","XHRRequest","asyncToGeneratorRuntime","clearTimeout","cr:1209197","cr:1209198","getCrossOriginTransport","requireWeak","setTimeout"],(function(t,n,r,o,a,i,l){var e,s,u=5e3,c=function(t){n("cr:1209197")!=null?n("cr:1209197").onLeave(t):n("cr:1209198")!=null?n("cr:1209198").onUnload(t):r("FBLogger")("video").mustfix("Dash prefetch cache onNavigatingAway handler was not properly set")},d=null;r("requireWeak")("VideoPlayerShakaBandwidthEstimator",function(e){return d=e});var m=null;r("requireWeak")("VideoStreamingTaskQueueProvider",function(e){return m=e});function p(e){return e.audio.length+e.video.length+e.manifest.length}function _(e,t){(s||(s=o("ODS"))).bumpEntityKey(2966,"www_video_playback","prefetch."+e,t)}function f(e){var t="aborted",n={status:0},r=new Error("Prefetch request aborted.");return Object.assign(r,{type:t,url:e,xhr:n})}function g(e){var t=e.getURI(),n=t.toString();if(o("VideoAkamaiRequestHelper").isAkamai(n)){var r=o("VideoAkamaiRequestHelper").getRequestHeadersFromUrl(n),a=t.removeQueryData(["bytestart","byteend"]);e.setURI(a),r&&Object.keys(r).forEach(function(t){e.setRequestHeader(t,r[t])})}return e}var h=null,y=new Map;function C(e,t){return t===void 0&&(t=!1),t&&o("VideoDashPrefetchCacheUtils").isFBCDN(e)?r("getCrossOriginTransport").withCredentials:r("getCrossOriginTransport")}function b(e){return o("VideoDashPrefetchCacheUtils").isFBCDN(e.url)}function v(e,t,n){return{response:e.slice(t.start+0,t.end+1),responseTime:n,initiator:"XHR_REQUEST"}}var S=(function(){function t(){this.$2=new Map,this.$9=new Map,this.$10=new Map,this.$1=new Map,this.$3=[],this.$4=[],this.$5=0,this.$6=r("VideoPlayerPrefetchExperiments").maxPrefetchVideosNum,this.$7=r("VideoPlayerPrefetchExperiments").consolidateFragmentedPrefetchRequest}var a=t.prototype;return a.$11=function(t,n){var e=this;n===void 0&&(n=!1);var a=t,i=window.fetch,l=r("VideoPlayerPrefetchExperiments").useFetch;if(l&&i&&"AbortController"in window){var s=new AbortController,u=s.signal,c=i(a,{signal:u,credentials:n?"include":"same-origin"}).then(function(t){return e.$12(c),{initiator:"FETCH",response:t}});return this.$13(t,c),this.$3.push(babelHelpers.extends({},c,{abort:function(){s.abort()}})),c}var d=new(r("XHRRequest"))(a).setMethod("GET").setResponseType("arraybuffer").setTransportBuilder(C(a,n));g(d);var m=new(r("MaybeNativePromise"))(function(n,r){d.setErrorHandler(function(t){e.$12(d),r(o("VideoPlayerShakaError").translateError(t,a,"preload"))}),d.setResponseHandler(function(t){var r=t,o=d;e.$12(d),n(babelHelpers.extends({},o,{response:r,initiator:"XHR_REQUEST"}))}),d.setAbortHandler(function(){e.$12(d);var n=f(t);r(n)})});return this.$13(t,m),this.$3.push(d),this.$8?this.$8.push(d):d.send(),m},a.genPrefetchMpdNow=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return this.has(e)?null:this.$11(e)});function t(t){return e.apply(this,arguments)}return t})(),a.$14=function(n,r,o){r===void 0&&(r=!1),o===void 0&&(o=null);for(var e=[],a=0;a<n.length;a++){var i=t.createQueryStringURL(n[a]);this.has(i)||(e.push(this.$11(i,r).then(function(e){return _("received",1),e})),o!=null&&this.$2.set(i,o))}return _("sent",e.length),e},a.$15=function(i){var a=this,l=t.getConsolidatedURL(i);if(l==null)return this.$14(i);var s=new(r("XHRRequest"))(l).setMethod("GET").setResponseType("arraybuffer").setTransportBuilder(C(l));g(s);for(var u=Date.now(),c=[],d=0;d<i.length;d++){var m=t.createQueryStringURL(i[d]),p=new(r("Deferred"));this.has(m)||this.$13(m,p.getPromise()),c.push(p)}s.setErrorHandler(function(e){a.$12(s);for(var t=0;t<c.length;t++)c[t].reject(o("VideoPlayerShakaError").translateError(e,l,"preload"))}),s.setResponseHandler(function(e){for(var t=e,n=Date.now()-u,r=0;r<i.length;r++){var o=c[r],l=i[r];o.resolve(v(t,l,n))}a.$12(s)}),s.setAbortHandler(function(){for(var e=0;e<i.length;e++){var t=c[e];t.reject(new Error("Request aborted."))}}),this.$3.push(s),s.send(),_("consolidated.sent",1),_("sent",c.length);var f=c.map(function(e){return e.getPromise().then(function(e){return _("received",1),e})});return(e||(e=n("Promise"))).all(f).then(function(){return _("consolidated.received",1)}).catch(function(){}),f},a.$16=function(t){var e=this,n=t.connectionQualityLevel,o=t.useCredentials;this.$5++;var a=this.$7&&!o;r("VideoPlayerPrefetchExperiments").enableGlobalSchedulerForPrefetch&&(this.$8=[]);var i=a?this.$15(t.video):this.$14(t.video,o,n),l=a?this.$15(t.audio):this.$14(t.audio,o,n),s=this.$14(t.manifest,o),u=i.concat(l,s);if(this.$8){var c=this.$8||[];this.$8=null;var d=""+t.videoID,p=r("MaybeNativePromise").all(u).then(function(){},function(){}),_={cancel:function(){},getPromise:function(){return p},name:"prefetch task, "+d,run:function(){return d&&y.delete(d),c.forEach(function(e){return e.send()}),p}};m?(r("VideoPlayerPrefetchExperiments").switchPrefetchTaskToHighPriWhenPlayed&&d&&y.set(d,_),m.getQueue("video").enqueue(_,r("VideoPlayerPrefetchExperiments").prefetchPriority),this.$17()):(_.run(),r("MaybeNativePromise").all(u).then(function(){return e.$17()}).catch(function(){return e.$17()}))}else r("MaybeNativePromise").all(u).then(function(){return e.$17()}).catch(function(){return e.$17()})},a.$13=function(t,n){var e=this;t=o("VideoDashPrefetchCacheUtils").stripNonCachingParams(t),this.$1.values().next().done&&c(function(){for(var t=0;t<e.$3.length;t++)e.$3[t].abort();e.$3=[],e.$4=[],e.$5=0,e.$1.clear(),e.$10.forEach(function(e){r("clearTimeout")(e)}),e.$10.clear()}),this.$1.set(t,n);var a=r("setTimeout")(function(){e.$1.has(t)&&e.$1.delete(t),e.$10.delete(t)},u);this.$10.set(t,a)},a.$12=function(t){var e=this.$3.indexOf(t);e>-1&&this.$3.splice(e,1)},a.$17=function(){this.$5--;var e=this.$4.shift();e&&this.$16(e)},a.has=function(t){return t=o("VideoDashPrefetchCacheUtils").stripNonCachingParams(t),this.$1.has(t)},a.getConnectionQualityLevel=function(t){return this.$2.get(t)},a.getAndDelete=function(t){t=o("VideoDashPrefetchCacheUtils").stripNonCachingParams(t);var e=this.$1.get(t);if(e){_("cache.hit",1);var n=this.$10.get(t);n!=null&&(r("clearTimeout")(n),this.$10.delete(t))}else _("cache.miss",1);return this.$1.delete(t),_("retrieve",1),e},a.queueRequestBatch=function(t){this.$6===0||this.$5<this.$6?this.$16(t):(_("queued",p(t)),this.$4.push(t))},a.setCachedRepresentations=function(t,n){this.$9.set(t,n)},a.getCachedRepresentations=function(t){return this.$9.get(t)},t.getCachedRepresentations=function(n){return t.getInstance().getCachedRepresentations(n)},t.getInstance=function(){return h===null&&(h=new t),h},t.createQueryStringURL=function(t){var e=t.end,n=t.start,r;if(n!=null&&e!==null&&e!==void 0){var a;r=(a=o("ConstUriUtils").getUri(t.url))==null||(a=a.addQueryParam("bytestart",n))==null||(a=a.addQueryParam("byteend",e))==null?void 0:a.toString()}return r!=null?r:t.url},t.getConsolidatedURL=function(n){for(var e="",r=1/0,o=0,a=0;a<n.length;a++){var i=n[a],l=i.end,s=i.start,u=i.url;if(u==null||s==null||l==null)return null;if(e==="")e=u;else if(e!==u)return null;r=Math.min(r,s),o=Math.max(o,l)}return t.createQueryStringURL({url:e,start:r,end:o})},t.getPrefetchInfoFromRepresentation=function(t){return t.segments.map(function(e){return{url:t.url,start:e.start,end:e.end}})},t.getVideoRepresentationFromRepresentations=function(t,n){var e=t.find(function(e){return e.representation_id.endsWith("d")});if(!n&&d&&(n=d.getBandwidth()),!n)return e;for(var r=0;r<t.length;r++){var o=t[r],a=e&&e.bandwidth||0;a>o.bandwidth||n>o.bandwidth&&(e=o)}return e},t.loadVideoGivenAllRepresentations=function(n,r,o){if(!t.isAutoplayBandwidthRestrained()){var e=[],a=[];r.audio.length>0&&(e=t.getPrefetchInfoFromRepresentation(r.audio[0]),e.length>0&&a.push(r.audio[0].representation_id));var i=[],l=t.getVideoRepresentationFromRepresentations(r.video,o);l&&(i=t.getPrefetchInfoFromRepresentation(l),i.length>0&&a.push(l.representation_id));var s=t.getInstance();s.queueRequestBatch({audio:e,video:i,manifest:[],videoID:n,useCredentials:!1}),s.setCachedRepresentations(n,a)}},t.isAutoplayBandwidthRestrained=function(){return!!d&&d.isAutoplayBandwidthRestrained()},t.loadVideo=function(n,o,a){if(o=!!o,!(!r("VideoPlayerPrefetchExperiments").disableShakaBandwidthEstimator&&d&&d.isAutoplayBandwidthRestrained())&&!r("VideoPlayerPrefetchExperiments").disablePrefetchCache){var e=t.getInstance();Array.isArray(n.manifest)||(n.manifest=[]),n.video||(n.video=[]),n.audio||(n.audio=[]),e.queueRequestBatch({manifest:n.manifest.filter(b),video:n.video.filter(b),audio:n.audio.filter(b),videoID:n.videoID,useCredentials:o,connectionQualityLevel:a})}},t.getCacheValue=function(n){return t.getInstance().getAndDelete(n)},t.getConnectionQualityLevel=function(n){return t.getInstance().getConnectionQualityLevel(n)},t.hasCacheValue=function(n){return t.getInstance().has(n)},t.getPrefetchTaskByID=function(t){return y.get(t)||null},t})();l.default=S}),98);
__d("VideoFeedFastPreloadController",["DOMQuery","Run"],(function(t,n,r,o,a,i,l){var e=0;function s(n){e<2&&(n=o("DOMQuery").scry(n,"video")[0],n instanceof t.HTMLVideoElement&&(e||o("Run").onBeforeUnload(function(){return u()}),n.preload="auto",e+=1))}function u(){e=0}u(),l.preload=s,l.reset=u}),98);